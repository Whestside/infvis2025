<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Assignment 0</title>


</head>
<body>
    <h1> Assignment 1 </h1>
    <svg width="1000" height="600"></svg>

    <script type="module">
      import * as d3 from "https://cdn.jsdelivr.net/npm/d3@7/+esm";

      d3.json("/assignment0").then( data => {

        const groups = data.Tested.map(d => d ? "Tested" : "Untested");
        console.log(groups);
        const categories = Object.keys(data).filter( n => n !== 'Tested');

        const series = [];
        categories.forEach(cat => {
          groups.forEach((group, i) => {
            series.push({ category: cat, tested: group, value: data[cat][i] });
          });
        });


        // --- Setup SVG and scales ---
        const svg = d3.select("svg");
        const margin = { top: 30, right: 20, bottom: 60, left: 60 };
        const width = +svg.attr("width") - margin.left - margin.right;
        const height = +svg.attr("height") - margin.top - margin.bottom;

        const g = svg.append("g").attr("transform", `translate(${margin.left},${margin.top})`);

        const x0 = d3.scaleBand()
          .domain(categories)
          .range([0, width])
          .paddingInner(0.5);

        const x1 = d3.scaleBand()
          .domain(["Tested", "Untested"])
          .range([0, x0.bandwidth()])
          .padding(0.01);

        const y = d3.scaleLinear()
          .domain([0, d3.max(series, s => s.value)])
          .nice()
          .range([height, 0]);

        const color = d3.scaleOrdinal()
          .domain(["Tested", "Untested"])
          .range(["#1f77b4", "#ff7f0e"]);

        // --- Draw bars ---
        const grouped = d3.group(series, s => s.category)
        g.selectAll("g.category")
          .data(grouped)
          .join("g")
          .attr("class", "category")
          .attr("transform", ([cat]) => `translate(${x0(cat)},0)`)
          .selectAll("rect")
          .data(([_, values]) => values)
          .join("rect")
          .attr("x", d => x1(d.tested))
          .attr("y", d => y(d.value))
          .attr("width", x1.bandwidth())
          .attr("height", d => height - y(d.value))
          .attr("fill", d => color(d.tested));

        // --- Axes ---
        g.append("g")
          .attr("transform", `translate(0,${height})`)
          .call(d3.axisBottom(x0))
          .selectAll("text")
          .attr("transform", "rotate(-30)")
          .style("text-anchor", "end");

        g.append("g").call(d3.axisLeft(y));

        // --- Legend ---
        const legend = svg.append("g")
          .attr("transform", `translate(${width - 120},20)`);

        ["Tested", "Untested"].forEach((label, i) => {
          legend.append("rect")
            .attr("x", 0)
            .attr("y", i * 20)
            .attr("width", 20)
            .attr("height", 20)
            .attr("fill", color(label));
          legend.append("text")
            .attr("x", 30)
            .attr("y", i * 20 + 10)
            .text(label)
            .attr("font-size", "15px")
            .attr("dominant-baseline", "middle")
            .attr("text-anchor", "start");
        });

      })

    </script>
</body>
</html>